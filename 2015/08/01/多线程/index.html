<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"deemonser.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="多线程能使程序高效率利用CPU资源。">
<meta property="og:type" content="article">
<meta property="og:title" content="多线程">
<meta property="og:url" content="https://deemonser.github.io/2015/08/01/%E5%A4%9A%E7%BA%BF%E7%A8%8B/index.html">
<meta property="og:site_name" content="Deemons&#39;s Blog">
<meta property="og:description" content="多线程能使程序高效率利用CPU资源。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g2gbgptoppj30go0axdhw.jpg">
<meta property="article:published_time" content="2015-08-01T15:28:11.000Z">
<meta property="article:modified_time" content="2021-09-14T09:07:30.000Z">
<meta property="article:author" content="Deemons">
<meta property="article:tag" content="Java 基础">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/006tNc79gy1g2gbgptoppj30go0axdhw.jpg">

<link rel="canonical" href="https://deemonser.github.io/2015/08/01/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>多线程 | Deemons's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Deemons's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://deemonser.github.io/2015/08/01/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/my_icon.jpeg">
      <meta itemprop="name" content="Deemons">
      <meta itemprop="description" content="不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deemons's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          多线程
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-08-01 23:28:11" itemprop="dateCreated datePublished" datetime="2015-08-01T23:28:11+08:00">2015-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-14 17:07:30" itemprop="dateModified" datetime="2021-09-14T17:07:30+08:00">2021-09-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Java基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1g2gbgptoppj30go0axdhw.jpg" alt="多线程"></p>
<p>多线程能使程序高效率利用CPU资源。</p>
<span id="more"></span>

<br>

<h3 id="进程与线程"><a href="#进程与线程" class="headerlink" title="进程与线程"></a>进程与线程</h3><p>​    进程：正在进行中的程序（直译）。<br>​    线程：进程中一个负责程序执行的控制单元（也叫执行路径）。</p>
<p>进程负责的是应用程序的空间的标示。线程负责的是应用程序的执行顺序。</p>
<br>

<blockquote>
<p>1、一个进程中可以有多个执行路径，称之为多线程。每个线程在栈区中都有自己的执行空间，自己的方法区、自己的变量。</p>
<p>2、一个进程中至少要有一个线程。</p>
<p>3、开启多个线程是为了同时运行多部分代码，每一个线程都有自己运行的内容，这个内容可以称为线程要执行的任务。</p>
</blockquote>
<br>

<p>多线程的好处：解决了多部分代码同时运行的问题。<br>多线程的弊端：线程太多，会导致效率的降低。<br>其实，多个应用程序同时执行都是CPU在做着快速的切换完成的。这个切换是随机的。CPU的切换是需要花费时间的，从而导致了效率的降低。</p>
<br>

<p>JVM启动时至少有两个线程启动：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 执行main函数的线程，该线程的任务代码都定义在main函数中。</span><br><span class="line">2. 负责垃圾回收的线程。</span><br></pre></td></tr></table></figure>

<br>

<h3 id="创建线程的方式"><a href="#创建线程的方式" class="headerlink" title="创建线程的方式"></a>创建线程的方式</h3><p>在 Java 中，创建线程的方式有两种，一种是继承 Thread 类，另一种是实现 Runnable  接口。</p>
<br>

<h4 id="1-继承Thread，复写run方法"><a href="#1-继承Thread，复写run方法" class="headerlink" title="1.继承Thread，复写run方法"></a>1.继承Thread，复写run方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 定义一个类继承Thread类。</span><br><span class="line">2. 覆盖Thread类中的run方法。</span><br><span class="line">3. 直接创建Thread的子类对象创建线程。</span><br><span class="line">4. 调用start方法开启线程并调用线程的任务run方法执行。</span><br></pre></td></tr></table></figure>

<br>

<p>单线程示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span></span>&#123;</span><br><span class="line">      <span class="keyword">private</span> String name ;</span><br><span class="line">      Demo(String name)&#123;</span><br><span class="line">             <span class="keyword">this</span>.name = name;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="number">10</span>; x++)&#123;</span><br><span class="line">                  System.out.println(name + <span class="string">&quot;...x=&quot;</span> + x);</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">            Demo d1 = <span class="keyword">new</span> Demo(<span class="string">&quot;旺财&quot;</span>);</span><br><span class="line">            Demo d2 = <span class="keyword">new</span> Demo(<span class="string">&quot;小强&quot;</span>);</span><br><span class="line">            d1.show();</span><br><span class="line">            d2.show();</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在单线程程序中，只有上一句代码执行完，下一句代码才有执行的机会。</p>
<p>创建线程的目的就是为了开启一条执行路径，去运行指定的代码和其他代码实现同时运行，而运行的指定代码就是这个执行路径的任务。</p>
<p> jvm创建的主线程的任务都定义在了主函数中。而自定义的线程，它的任务在Thread类中的run方法。也就是说，run方法就是封装自定义线程运行任务的函数，run方法中定义的就是线程要运行的任务代码。</p>
<br>

<p>多线程示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">      <span class="keyword">private</span> String name ;</span><br><span class="line">      Demo(String name)&#123;</span><br><span class="line">             <span class="keyword">this</span>.name = name;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="number">10</span>; x++)&#123;</span><br><span class="line">                  System.out.println(name + <span class="string">&quot;...x=&quot;</span> + x + <span class="string">&quot;...ThreadName=&quot;</span> + Thread.currentThread ().getName());</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">            Demo d1 = <span class="keyword">new</span> Demo(<span class="string">&quot;旺财&quot;</span>);</span><br><span class="line">            Demo d2 = <span class="keyword">new</span> Demo(<span class="string">&quot;xiaoqiang&quot;</span>);</span><br><span class="line">            d1.start(); <span class="comment">//开启线程，调用run方法。</span></span><br><span class="line">            d2.start();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="number">20</span>; x++)&#123;</span><br><span class="line">                  System.out.println(<span class="string">&quot;x = &quot;</span> + x + <span class="string">&quot;...over...&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<br>

<h4 id="2-实现一个-Runnable-接口"><a href="#2-实现一个-Runnable-接口" class="headerlink" title="2.实现一个 Runnable 接口"></a>2.实现一个 Runnable 接口</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 定义类实现Runnable接口。</span><br><span class="line">2. 覆盖接口中的run方法，将线程的任务代码封装到run方法中。</span><br><span class="line">3. 通过Thread类创建线程对象，并将Runnable接口的子类对象作为Thread类的构造函数的参数进行传递。为什么？因为线程的任务都封装在Runnable接口子类对象的run方法中。所以要在线程对象创建时就必须明确要运行的任务。</span><br><span class="line">4. 调用线程对象的start方法开启线程</span><br></pre></td></tr></table></figure>

<br>

<p>实现Runnable接口的好处：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 将线程的任务从线程的子类中分离出来，进行了单独的封装，按照面向对象的思想将任务封装成对象。</span><br><span class="line">2. 避免了Java单继承的局限性。所以，创建线程的第二种方式较为常用。</span><br></pre></td></tr></table></figure>

<br>

<p>示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//准备扩展Demo类的功能，让其中的内容可以作为线程的任务执行。</span></span><br><span class="line"><span class="comment">//通过接口的形式完成。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">            show();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="number">20</span>; x++)&#123;</span><br><span class="line">                  System.out.println(Thread.currentThread().getName() + <span class="string">&quot;...&quot;</span> + x);</span><br><span class="line">             &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">            Demo d = <span class="keyword">new</span> Demo();</span><br><span class="line">            Thread t1 = <span class="keyword">new</span> Thread(d);</span><br><span class="line">            Thread t2 = <span class="keyword">new</span> Thread(d);</span><br><span class="line">            t1.start();</span><br><span class="line">            t2.start();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<br>

<h3 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h3><p>多线程很大程度上提高了程序的执行效率，但与此同时，也带来了安全问题。</p>
<br>

<h4 id="线程安全问题产生的原因"><a href="#线程安全问题产生的原因" class="headerlink" title="线程安全问题产生的原因"></a>线程安全问题产生的原因</h4><p>​    1. 多个线程在操作共享的数据。</p>
<p>​    2. 操作共享数据的线程代码有多条。</p>
<p>​    当一个线程在执行操作共享数据的多条代码过程中，其他线程参与了运算，就会导致线程安全问题的产生。</p>
<br>

<h4 id="线程安全问题的解决方案"><a href="#线程安全问题的解决方案" class="headerlink" title="线程安全问题的解决方案"></a>线程安全问题的解决方案</h4><p>将多条操作共享数据的线程代码封装起来，当有线程在执行这些代码的时候，其他线程不可以参与运算。必须要当前线程把这些代码都执行完毕后，其他线程才可以参与运算。</p>
<h5 id="方案1-同步代码"><a href="#方案1-同步代码" class="headerlink" title="方案1: 同步代码"></a>方案1: 同步代码</h5><p>在java中，用同步代码块就可以解决这个问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">同步代码块的格式：   </span></span><br><span class="line"><span class="comment">	synchronized(对象)&#123;</span></span><br><span class="line"><span class="comment">          // 需要被同步的代码;</span></span><br><span class="line"><span class="comment">    &#125; </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">      Object obj = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">while</span>(<span class="keyword">true</span> )&#123;</span><br><span class="line">                   <span class="keyword">synchronized</span>(obj )&#123;<span class="comment">//Object对象相当于是一把锁，只有抢到锁的线程，才能进入同步代码块向下执行。</span></span><br><span class="line">                         <span class="keyword">if</span>(num &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                              System.out.println(Thread.currentThread().getName() + <span class="string">&quot;...sale...&quot;</span> + num--);</span><br><span class="line">                        &#125;</span><br><span class="line">                   &#125; </span><br><span class="line">             &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketDemo</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">            Ticket t = <span class="keyword">new</span> Ticket();</span><br><span class="line">            Thread t1 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">            Thread t2 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">            Thread t3 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">            Thread t4 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">            </span><br><span class="line">            t1.start();</span><br><span class="line">            t2.start();</span><br><span class="line">            t3.start();</span><br><span class="line">            t4.start();</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<p>同步的好处：解决了线程的安全问题。<br>同步的弊端：当线程相当多时，因为每个线程都会去判断同步上的锁，这是很耗费资源的，无形中会降低程序的运行效率。<br>同步的前提：必须有多个线程并使用同一个锁。</p>
<br>

<h5 id="方案2-同步函数"><a href="#方案2-同步函数" class="headerlink" title="方案2:同步函数"></a>方案2:同步函数</h5><p>在函数上加上 <strong>synchronized</strong> 修饰符也同样可以达到效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bank</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">int</span> sum ;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123; <span class="comment">//同步函数</span></span><br><span class="line">             sum = sum + num;</span><br><span class="line">             System.out.println(<span class="string">&quot;sum = &quot;</span> + sum);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<p>同步函数和同步代码块的区别：<br>​    1. 同步函数的锁是固定的this。<br>​    2. 同步代码块的锁是任意的对象。</p>
<p> 静态的同步函数使用的锁是该函数所属字节码文件对象，可以用getClass方法获取，也可以用当前类名.class表示。</p>
<p>多线程下的单例模式示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//恶汉式，不存在安全问题，因为不存在多个线程共同操作数据的情况</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OneSingle</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> OneSingle s = <span class="keyword">new</span> OneSingle();</span><br><span class="line">       <span class="function"><span class="keyword">private</span> <span class="title">OneSingle</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OneSingle <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">return</span> s ;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//懒汉式,存在安全问题，可以使用同步函数解决</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Single</span></span>&#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> Single s = <span class="keyword">null</span>;</span><br><span class="line">       <span class="function"><span class="keyword">private</span> <span class="title">Single</span><span class="params">()</span></span>&#123;&#125; </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Single <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">if</span>(s ==<span class="keyword">null</span>)&#123;</span><br><span class="line">                   <span class="keyword">synchronized</span>(Single.class)&#123;<span class="comment">//静态函数需要所属字节码文件对象</span></span><br><span class="line">                         <span class="keyword">if</span>(s == <span class="keyword">null</span>)</span><br><span class="line">                               s = <span class="keyword">new</span> Single();</span><br><span class="line">                  &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> s ;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<br>

<h4 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h4><p>在解决线程安全的情况下，又带来一个新的问题，那就是死锁。</p>
<p>同步嵌套很容易产生死锁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">       Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">       <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">if</span>(flag )&#123;</span><br><span class="line">                   <span class="keyword">while</span>(<span class="keyword">true</span> )&#123;</span><br><span class="line">                         <span class="keyword">synchronized</span>(obj )&#123;<span class="comment">//t1线程 拿到 obj 的锁后，执行show 方法</span></span><br><span class="line">                              show();</span><br><span class="line">                        &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">                   <span class="keyword">while</span>(<span class="keyword">true</span> )</span><br><span class="line">                        show();	<span class="comment">//t2 线程执行</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   		<span class="comment">// 此处是两线程同步处，此时t1线程已经拿到 obj的锁，t2则还没有锁</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">         	<span class="comment">//此时，如果t2线程进来，表示t2 拿到了 this 锁，在这一步又需要t1持有的 obj  的锁，就会死锁</span></span><br><span class="line">             <span class="keyword">synchronized</span>(obj )&#123; </span><br><span class="line">                   <span class="keyword">if</span>(num &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                         <span class="keyword">try</span>&#123;</span><br><span class="line">                              Thread. sleep(<span class="number">10</span>);</span><br><span class="line">                        &#125; <span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                              e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;...function...&quot;</span> + num--);</span><br><span class="line">                  &#125;</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeadLockDemo</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">            Ticket t = <span class="keyword">new</span> Ticket();</span><br><span class="line">            Thread t1 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">            Thread t2 = <span class="keyword">new</span> Thread(t);</span><br><span class="line">            </span><br><span class="line">            t1.start();</span><br><span class="line">             <span class="keyword">try</span>&#123;</span><br><span class="line">                  Thread. sleep(<span class="number">10</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                  e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            t. flag = <span class="keyword">false</span> ;</span><br><span class="line">            t2.start();</span><br><span class="line">      &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<br>

<br>

<h3 id="等待唤醒机制"><a href="#等待唤醒机制" class="headerlink" title="等待唤醒机制"></a>等待唤醒机制</h3><p>多个线程在处理统一资源，但是任务却不同，这时候就需要线程间通信。</p>
<p>在 Java 中 <strong>等待/唤醒 机制</strong>  就是处理线程间通信的。</p>
<p>等待/唤醒机制涉及的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. wait()：让线程处于冻结状态，被wait的线程会被存储到线程池中。</span><br><span class="line">2. notify()：唤醒线程池中的一个线程（任何一个都有可能）。</span><br><span class="line">3. notifyAll()：唤醒线程池中的所有线程。</span><br></pre></td></tr></table></figure>



<blockquote>
<p>注意 </p>
<ol>
<li>这些方法都需要定义在同步中，因为这些方法是用于操作线程状态的方法。</li>
<li>方法必须要标示所属的锁。</li>
<li>这三个方法都定义在 Object 类中。这三个方法都需要定义在同步内，并标示所属的同步锁，既然被锁调用，而锁又可以是任意对象，那么能被任意对象调用的方法一定定义在 Object 类中。 </li>
</ol>
</blockquote>
<p>wait 和 sleep 区别<br>​         1）wait可以指定时间也可以不指定。sleep必须指定时间。<br>​         2）在同步中时，对CPU的执行权和锁的处理不同。<br>​         wait：释放执行权，释放锁。<br>​         sleep：释放执行权，不释放锁。</p>
<p>生产者消费者示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> String name ;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(flag )</span><br><span class="line">                   <span class="keyword">try</span>&#123;</span><br><span class="line">                         <span class="keyword">this</span>.wait();</span><br><span class="line">                  &#125; <span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                  &#125;</span><br><span class="line">             <span class="keyword">this</span>.name = name + count;</span><br><span class="line">             count++;</span><br><span class="line">             System.out.println(Thread.currentThread().getName() + <span class="string">&quot;...生产者...&quot;</span> + <span class="keyword">this</span>. name);</span><br><span class="line">             flag = <span class="keyword">true</span> ;</span><br><span class="line">             notifyAll();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">out</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">while</span>(!flag )</span><br><span class="line">                   <span class="keyword">try</span>&#123;</span><br><span class="line">                         <span class="keyword">this</span>.wait();</span><br><span class="line">                  &#125; <span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                  &#125;</span><br><span class="line">            flag = <span class="keyword">false</span> ;</span><br><span class="line">            notifyAll();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;...消费者...&quot;</span> + <span class="keyword">this</span>. name);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> Resource r ;</span><br><span class="line">      Producer(Resource r)&#123;</span><br><span class="line">             <span class="keyword">this</span>.r = r;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">while</span>(<span class="keyword">true</span> )&#123;</span><br><span class="line">                   r.set( <span class="string">&quot;烤鸭&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> Resource r ;</span><br><span class="line">      Consumer(Resource r)&#123;</span><br><span class="line">             <span class="keyword">this</span>.r = r;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">while</span>(<span class="keyword">true</span> )&#123;</span><br><span class="line">                   r.out();</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProducerConsumerDemo</span> </span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">            Resource r = <span class="keyword">new</span> Resource();</span><br><span class="line">            Producer pro = <span class="keyword">new</span> Producer(r);</span><br><span class="line">            Consumer con = <span class="keyword">new</span> Consumer(r);</span><br><span class="line"></span><br><span class="line">            Thread t0 = <span class="keyword">new</span> Thread(pro);</span><br><span class="line">            Thread t1 = <span class="keyword">new</span> Thread(pro);</span><br><span class="line">            Thread t2 = <span class="keyword">new</span> Thread(con);</span><br><span class="line">            Thread t3 = <span class="keyword">new</span> Thread(con);</span><br><span class="line">            t0.start();</span><br><span class="line">            t1.start();</span><br><span class="line">            t2.start();</span><br><span class="line">            t3.start();</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<br>

<h3 id="Lock接口"><a href="#Lock接口" class="headerlink" title="Lock接口"></a>Lock接口</h3><p>同步代码块就是对于锁的操作是隐式的。<br>JDK1.5以后将同步和锁封装成了对象，并将操作锁的隐式方式定义到了该对象中，将隐式动作变成了显示动作。</p>
<br>

<p>Lock接口的出现替代了同步代码块或者同步函数，将同步的隐式操作变成显示锁操作。同时更为灵活，可以一个锁上加上多组监视器。</p>
<p>lock()：获取锁。</p>
<p>unlock()：释放锁，为了防止异常出现，导致锁无法被关闭，所以锁的关闭动作要放在finally中。</p>
<br>

<p>Condition接口的出现替代了Object中的wait、notify、notifyAll方法。将这些监视器方法单独进行了封装，变成Condition监视器对象，可以任意锁进行组合。</p>
<p>Condition接口中的await方法对应于Object中的wait方法。</p>
<p>Condition接口中的signal方法对应于Object中的notify方法。</p>
<p>Condition接口中的signalAll方法对应于Object中的notifyAll方法。</p>
<br>

<p>使用一个Lock、一个Condition修改上面的多生产者-多消费者问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.*;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> String name ;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//创建一个锁对象</span></span><br><span class="line">      Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//通过已有的锁获取该锁上的监视器对象      </span></span><br><span class="line">      Condition con = lock .newCondition();</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">             lock.lock();</span><br><span class="line">             <span class="keyword">try</span>&#123;</span><br><span class="line">                   <span class="keyword">while</span>(flag )</span><br><span class="line">                         <span class="keyword">try</span>&#123;</span><br><span class="line">                              con.await();</span><br><span class="line">                        &#125; <span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                              e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                   <span class="keyword">this</span>.name = name + count;</span><br><span class="line">                   count++;</span><br><span class="line">                   System.out.println(Thread.currentThread().getName() + <span class="string">&quot;...生产者...&quot;</span> + <span class="keyword">this</span>. name);</span><br><span class="line">                   flag = <span class="keyword">true</span> ;</span><br><span class="line">                   con.signalAll();</span><br><span class="line">            &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">                   lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">out</span><span class="params">()</span></span>&#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">             <span class="keyword">try</span>&#123;</span><br><span class="line">                   <span class="keyword">while</span>(!flag )</span><br><span class="line">                         <span class="keyword">try</span>&#123;</span><br><span class="line">                              con.await();</span><br><span class="line">                        &#125; <span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                              e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                   flag = <span class="keyword">false</span> ;</span><br><span class="line">                   con.signalAll();</span><br><span class="line">                   System.out.println(Thread.currentThread().getName() + <span class="string">&quot;...消费者...&quot;</span> + <span class="keyword">this</span>. name);</span><br><span class="line">            &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">                   lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> Resource r ;</span><br><span class="line">       Producer(Resource r)&#123;</span><br><span class="line">             <span class="keyword">this</span>.r = r;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">while</span>(<span class="keyword">true</span> )&#123;</span><br><span class="line">                   r.set( <span class="string">&quot;烤鸭&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">       <span class="keyword">private</span> Resource r ;</span><br><span class="line">       Consumer(Resource r)&#123;</span><br><span class="line">             <span class="keyword">this</span>.r = r;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">             <span class="keyword">while</span>(<span class="keyword">true</span> )&#123;</span><br><span class="line">                   r.out();</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProducerConsumerDemo</span> </span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">            Resource r = <span class="keyword">new</span> Resource();</span><br><span class="line">            Producer pro = <span class="keyword">new</span> Producer(r);</span><br><span class="line">            Consumer con = <span class="keyword">new</span> Consumer(r);</span><br><span class="line"></span><br><span class="line">            Thread t0 = <span class="keyword">new</span> Thread(pro);</span><br><span class="line">            Thread t1 = <span class="keyword">new</span> Thread(pro);</span><br><span class="line">            Thread t2 = <span class="keyword">new</span> Thread(con);</span><br><span class="line">            Thread t3 = <span class="keyword">new</span> Thread(con);</span><br><span class="line">            t0.start();</span><br><span class="line">            t1.start();</span><br><span class="line">            t2.start();</span><br><span class="line">            t3.start();</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<br>

<h3 id="线程停止"><a href="#线程停止" class="headerlink" title="线程停止"></a>线程停止</h3><p>当一个线程运行后，怎样才能让其停止呢？</p>
<p>通过 stop 方法就可以停止线程。但是这个方式过时了。 </p>
<p>线程停止的原理就是让线程运行的代码结束，也就是结束 run 方法。</p>
<p>怎么结束 run 方法？</p>
<p>一般 run 方法里肯定定义循环。所以只要结束循环即可。</p>
<ul>
<li>定义循环的结束标记。</li>
<li>如果线程处于了冻结状态，是不可能读到标记的，这时就需要通过 Thread 类中的 interrupt 方法，将其冻结状态强制清除。让线程恢复具备执行资格的状态，让线程可以读到标记，并结束。</li>
</ul>
<br>

<br>

<h3 id="线程的其他方法"><a href="#线程的其他方法" class="headerlink" title="线程的其他方法"></a>线程的其他方法</h3><h4 id="setDaemon方法"><a href="#setDaemon方法" class="headerlink" title="setDaemon方法"></a>setDaemon方法</h4><p>将该线程标记为守护线程或用户线程。当正在运行的线程都是守护线程时，Java虚拟机退出。</p>
<p>该方法必须在启动线程前调用。</p>
<br>

<h4 id="join方法"><a href="#join方法" class="headerlink" title="join方法"></a>join方法</h4><p>等待该线程终止</p>
<br>

<h4 id="setPriority方法"><a href="#setPriority方法" class="headerlink" title="setPriority方法"></a>setPriority方法</h4><p>更改线程的优先级</p>
<br>

<h4 id="toString方法"><a href="#toString方法" class="headerlink" title="toString方法"></a>toString方法</h4><p>返回该线程的字符串表示形式，包括线程名称、优先级和线程组。</p>
<br>

<h4 id="yield方法"><a href="#yield方法" class="headerlink" title="yield方法"></a>yield方法</h4><p>暂停当前正在执行的线程对象，并执行其他线程。</p>
<br>

<br>

<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/wxd0108/p/5479442.html">Java中的多线程你只要看这一篇就够了</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/GarfieldEr007/p/5746362.html">Java多线程学习（吐血超详细总结）</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java-%E5%9F%BA%E7%A1%80/" rel="tag"># Java 基础</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2015/07/30/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="prev" title="面向对象">
      <i class="fa fa-chevron-left"></i> 面向对象
    </a></div>
      <div class="post-nav-item">
    <a href="/2015/08/02/%E9%9B%86%E5%90%88/" rel="next" title="集合">
      集合 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.</span> <span class="nav-text">进程与线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">2.</span> <span class="nav-text">创建线程的方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%BB%A7%E6%89%BFThread%EF%BC%8C%E5%A4%8D%E5%86%99run%E6%96%B9%E6%B3%95"><span class="nav-number">2.1.</span> <span class="nav-text">1.继承Thread，复写run方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA-Runnable-%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.2.</span> <span class="nav-text">2.实现一个 Runnable 接口</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="nav-number">3.</span> <span class="nav-text">线程安全</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%E4%BA%A7%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="nav-number">3.1.</span> <span class="nav-text">线程安全问题产生的原因</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">3.2.</span> <span class="nav-text">线程安全问题的解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B9%E6%A1%881-%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81"><span class="nav-number">3.2.1.</span> <span class="nav-text">方案1: 同步代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B9%E6%A1%882-%E5%90%8C%E6%AD%A5%E5%87%BD%E6%95%B0"><span class="nav-number">3.2.2.</span> <span class="nav-text">方案2:同步函数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%BB%E9%94%81"><span class="nav-number">3.3.</span> <span class="nav-text">死锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%89%E5%BE%85%E5%94%A4%E9%86%92%E6%9C%BA%E5%88%B6"><span class="nav-number">4.</span> <span class="nav-text">等待唤醒机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lock%E6%8E%A5%E5%8F%A3"><span class="nav-number">5.</span> <span class="nav-text">Lock接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%81%9C%E6%AD%A2"><span class="nav-number">6.</span> <span class="nav-text">线程停止</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="nav-number">7.</span> <span class="nav-text">线程的其他方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#setDaemon%E6%96%B9%E6%B3%95"><span class="nav-number">7.1.</span> <span class="nav-text">setDaemon方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#join%E6%96%B9%E6%B3%95"><span class="nav-number">7.2.</span> <span class="nav-text">join方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setPriority%E6%96%B9%E6%B3%95"><span class="nav-number">7.3.</span> <span class="nav-text">setPriority方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toString%E6%96%B9%E6%B3%95"><span class="nav-number">7.4.</span> <span class="nav-text">toString方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#yield%E6%96%B9%E6%B3%95"><span class="nav-number">7.5.</span> <span class="nav-text">yield方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">8.</span> <span class="nav-text">补充</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Deemons"
      src="/img/my_icon.jpeg">
  <p class="site-author-name" itemprop="name">Deemons</p>
  <div class="site-description" itemprop="description">不积小流，无以成江海。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">89</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备19061230号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Deemons</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
